<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width,initial-scale=1'>

        <title>Login into "Riders on the SCORM"</title>

        <link rel='icon' type='image/png' href='/favicon.png'>
        <link rel='stylesheet' href='/global.css'>
        <link rel='stylesheet' href='/bundle.css'>

        <meta name="google-signin-client_id" content="815614717875-a9r31195dd4a1ef5nfk695aetp4hb7fo.apps.googleusercontent.com">
        <script src="https://apis.google.com/js/platform.js?onload=renderLogin" async defer></script>
        <script>
            function onSuccess(googleUser) {
                const tokenid = googleUser.getAuthResponse().id_token
                fetch('/login', { 
                    method: 'post',
                    headers: new Headers({'content-type': 'application/json'}),
                    body: JSON.stringify({tokenid})
                })
                .then(res => res.json())
                .then(user => {
                    if (!user.status) throw user
                    window.location.assign(`/users/${user.uid}`)
                })
                .catch(console.error)
            }
            function renderLogin() {
                gapi.signin2.render('login', {
                    scope: 'profile email',
                    width: 240,
                    height: 50,
                    longtitle: true,
                    theme: 'dark',
                    onsuccess: onSuccess,
                    onfailure: console.error
                })
            }
        </script>
        <style>
            .login-page {
                height: 100vh;
                width: 100vw;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .login-page article {
                width: 370px;
                height: 260px;
                background: white;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                border-radius: 12px;
                box-shadow: 1px 1px 6px -2px gray;
                box-sizing:border-box;
            }
            .login-page article h1 {
                margin-block-start: 0;
                font-size: 1rem;
                margin-bottom: 2rem;
            }
        </style>
    </head>
    <body>
        <main class="login-page">
            <article>
                <h1>Markdown SCORM</h1>
                <div id="login"></div>
            </article>
        </main>
    </body>
</html>